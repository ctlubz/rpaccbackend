<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.chinatelecom.rpaccbackend.dao.CommonDAO">
    <select id="orderPoolIndex" resultType="com.chinatelecom.rpaccbackend.pojo.entity.OrderIndex">
        SELECT oi.order_id as orderId,
               oi.init_time as initTime,
               oi.customer_number as customerNumber,
               op.order_status as orderStatus,
               op.remark,
               op.busi_type as busiType
            FROM tb_order_info as oi
            INNER JOIN tb_order_pool as op
            ON oi.order_id=op.order_id
    </select>
    <delete id="deleteByDate">
        DELETE FROM tb_order_ignore
        WHERE create_time &lt; #{time}
    </delete>
    <insert id="insertIntoExecuting">
        INSERT INTO tb_executing(
            order_id,is_deleted,create_time
        )VALUES (
                    #{order_id},
                    '0',
                    now()
                )
    </insert>
    <select id="getFullNameBySimpleName" resultType="java.lang.String">
        SELECT full_name FROM tb_package_mapping
        WHERE simple_name=#{simple_name}
        AND type=#{type}
    </select>


    <update id="updateExecuting">
        UPDATE tb_order_pool
        SET order_status=3
        WHERE order_id IN(
            SELECT order_id FROM tb_executing
            WHERE is_deleted=0
            AND create_time &lt; #{time}
        );
        UPDATE tb_executing
        SET is_deleted=1
        WHERE create_time &lt; #{time};
    </update>
</mapper>